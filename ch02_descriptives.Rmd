---
header-includes:
  - \usepackage[para,online,flushleft]{threeparttable}
output: 
  pdf_document:
    keep_tex: yes
bibliography: "/home/jflournoy/code_new/social-motives-rl-writeup/dissertation.bib"
csl: "/home/jflournoy/Rlibs/probly/bib/apa-old-doi-prefix.csl"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning = F, error = F, message = F)
library(probly)
load('rda/descriptive-statistics.rda')
ptab <- Hmisc::latex

ethnicity_labels <- c(
    'American Indian and Alaska Native' = 'AmIndn',
    'Asian' = 'Asian',
    'Black or African American' = 'Black/AA',
    'Latinx/Hispanic' = 'Latinx/Hsp',
    'Native Hawaiian and Other Pacific Islander' = 'Pcfc Islnd',
    'Other' = 'Other',
    'White' = 'White',
    'White/Hispanic' = 'Wht/Hsp'
)
ethnicity_abbreviation_note <- paste0(paste(paste0(ethnicity_labels, ': ', names(ethnicity_labels)), collapse = '; '), '.')

sample_abbreviation_note <- 'FC: foster-care-involved adolescents; Comm: community adolescents; CS: college students; CS-O: college students, online.'
```

# Participants

Data from four samples are used in this analysis. 
The first two samples comprise foster-care-involved and community adolescents who were recruited from the greater Eugene/Springfield area for an ongoing longitudinal study investigating decision-making related to health-risking behavior (NIH grant number:). 
The third and forth samples consisted of college students who completed the study for course credit either in person, or online. 
Some participants in each sample did not provide data on all focal measures (see Table \ref{tab:missingstats}), and so sample sizes for each analysis will differ to some extent.
Examining the table, it is clear that the proportion of missing data is small.

The full sample consists of `r sum(!is.na(splt_dev_and_demog_task_sum$SID))` participants (`r sum(splt_dev_and_demog_task_sum$gender_num==1, na.rm=T)` male) with ages between `r round(min(splt_dev_and_demog_task_sum$age, na.rm = T), 1)` and `r round(max(splt_dev_and_demog_task_sum$age, na.rm = T), 1)` years (see Table \ref{tab:samplestats} for full details). 
The majority of participants in all samples identified as white, though in the both college samples this majority did not exceed 60% (Table \ref{tab:ethnicitytable}).

```{r maketables}
library(tables)
mean.na.rm <- function(x){mean(as.numeric(x), na.rm=T)}
sd.na.rm <- function(x){sd(x, na.rm=T)}
nmissing <- function(x){m <- sum(is.na(x));ifelse(m==0,'-',m)}
prct_missing <- function(x,y){pct <- 100*sum(is.na(x))/length(y);ifelse(pct==0,'\\-',pct)}
minmax.na.rm <- function(x){sprintf('[%0.0f,%0.0f]',round(min(x, na.rm = T),0), round(max(x, na.rm = T),0))}

splt_dev_and_demog_task_sum$sample <- 
    factor(splt_dev_and_demog_task_sum$sample, 
           levels = c("Foster-care involved adolescents", 
                      "Community adolescents", 
                      "College students", 
                      "College students - online"), 
           labels = c('FC', 'Comm', 'CS', 'CS-O'))

sample_table <- tables::tabular(
    (Sample=sample) ~ 
        (N = 1)*Heading()*(gender) +
        (Format(digits=2)*(Age = age) + 
             Format(digits=1)*(PDS = PDS_mean_score))*Heading()*(gender)*
                  ((M = mean.na.rm) + 
                       (`SD` = sd.na.rm)), 
    data = splt_dev_and_demog_task_sum)

trials_table <- tables::tabular(
    (Sample=sample) ~ 
        (Format(digits=0)*(`$N_{\\text{trials}}$` = ntrials))*Heading()*(gender)*
                  ((M = mean.na.rm) + 
                       (`SD` = sd.na.rm)), 
    data = splt_dev_and_demog_task_sum)

missing_table <- tables::tabular(
    ((Sample=sample) + 1) ~ 
        (N=1) +
             (((Age=age) + (PDS=PDS_mean_score) + (Gender = gender_num) + (Task = ntrials))*
                  ((`$N_{\\text{miss}}$` = nmissing) + Format(digits=1)*(`\\%` = Percent(fn = prct_missing)))), 
    data = splt_dev_and_demog_task_sum)

optimal_press_prop_table <- tables::tabular((Condition = condition)*(Sample = sample) ~ 
                    Heading('Probability of reward')*
                    identity*Heading()*Format(digits=3)*p_optimal_correct, 
                data = splt_summary_optimal_feedback)
ethnicity_table <- tables::tabular(
    Heading('Percent (\\%)')*ethnicity*Heading()*Format(digits=1)*Percent(denom = 'col') ~
        1 + Heading()*(Sample = sample),
    data = splt_dev_and_demog_task_sum)
```

\begin{table}
\centering
\begin{threeparttable}
\caption{Missing data from each sample for age, PDS, and gender} \label{tab:missingstats}
\small
```{r missingstats, results='asis'}
ptab(missing_table)
```
\begin{tablenotes}
\footnotesize
\item `r sample_abbreviation_note` PDS: Pubertal development scale.
\end{tablenotes}
\end{threeparttable}
\end{table}

\begin{table}
\centering
\begin{threeparttable}
\caption{Descriptive statistics on age, and PDS for each sample} \label{tab:samplestats}
\small
```{r samplestats, results='asis'}
ptab(sample_table)
```
\begin{tablenotes}
\footnotesize
\item `r sample_abbreviation_note` PDS: Pubertal development scale. 
\end{tablenotes}
\end{threeparttable}
\end{table}

\begin{table}
\centering
\begin{threeparttable}
\caption{Race/ethnicity information by sample} \label{tab:ethnicitytable}
\small
```{r ethnicitytable, results='asis'}
ptab(ethnicity_table)
```
\begin{tablenotes}
\footnotesize
\item `r sample_abbreviation_note` `r ethnicity_abbreviation_note`
\end{tablenotes}
\end{threeparttable}
\end{table}

## Pubertal Development

To assess pubertal development, all participants completed the Pubertal Development Scale [PDS; @petersen1988], with the mean of five items used to indicate progress through puberty (range [1,4]).
While the full sample includes a wide range of pubertal development, there is notable heterogeneity.
It is not surprising that almost all participants in the college samples report that puberty is complete.
Notably (though also unsurprisingly), females in the the adolescent samples report being further through puberty than males (Figure \ref{fig:pdsplot}A), even though the mean age of males and females in these samples is roughly equivalent (Table \ref{tab:samplestats}).
Most participants in the college smaples have PDS scores indicating puberty is completed, or nearly completed (Figure \ref{fig:pdsplot}B).

```{r pdsplot, fig.width=8, fig.height=5, fig.cap='\\label{fig:pdsplot}Pubertal development by sample and age'}
gridExtra::grid.arrange(pds_plot_12)
```

# Measures

## Social Probabilistic Learning Task

The Social Probabilistic Learning Task (SPLT) is a standard reinforcement learning paradigm using several stimulus-word pairings that are grouped by motive relevance.
Common probabilistic reinforcement learning paradigms focus on estimating parameters that govern learning associations between stimuli using abstract images and nonsocial categories as the conditioned stimulus [e.g., a weather prediction of 'sunny' or 'rainy'; @knowlton1996].
In the SPLT, motive context is manipulated by pairing human faces with state or trait words related to mate-seeking and status motives.
The purpose of this manipulation is to examine how this motive framing alters learning, especially across adolescent development, as well as how individual differences in learning are related to the measures of attitudes and behavior outlined below.

On each trial, the participant sees one of six faces, along with two labels, and is asked to classify the face using one of the two labels.
The labels are: *Hungry* versus *Thirsty* (control condition that is nonsocial, or only minimally social), *Dating* versus *Looking* for someone to date (mate-seeking), and *Popular* versus *Unpopular* (status).
After choosing the label, the participant is given feedback that they were correct and earned either 1/1 point or 5/5 points, or that they were incorrect and earned 0/1 point or 0/5 points (Figure \ref{fig:trialexample}).
Each face is probabilistically associated with one label with P(Correct | Choice = Label) = .80.
That is, there is a probabilistically optimal choice response, which precludes a memorization strategy and results in more automatic reinforcement learning [@knowlton1996].
The participant is instructed that "the same word goes with the same picture most of the time, but not always," and to "try to guess correctly as often as you can to get the most points."


```{r trialexample, dpi=300, fig.cap='\\label{fig:trialexample}Example of a trial on the SPLT'}
knitr::include_graphics("figures/trial_example.png")
```


To ensure engagement with the stimulus faces, 3 unambiguously male and 3 unambiguously female faces were drawn from a set of faces evaluated by @todorov2008.
Target faces were drawn from a subset of those highest in likeability and attractiveness ratings, and were selected to have roughly equal euclidean distance from one another on the other dimensions on which they had been rated (e.g., trustworthiness).
Essentially, the faces were selected to be similarly salient, as well as similarly distinct from one another such that one or two particularly unique face did not overwhelm the learning effect of the motives.
On each run of the task (i.e., for each participant), one male and one female face was randomly assigned to each label within condition (control, mate-seeking, status).
On each trial, the participant had 3.5 seconds to respond, and was shown response feedback for 1 second.
The task comprises a total of 384 trials across 8 blocks.

The receipt of the reward for choosing the optimal response (that is, the response that most often generated a reward) was probabilistic.
Across conditions and samples, the observed probability of reward receipt for an optimal choice was very close to the generative _p_ = .80 (Table \ref{tab:optpressstats}).
Reaction times for all participants can be seen in Figure \ref{fig:reactiontime}, with an overall mean of `r round(mean(dplyr::filter(splt, rt > 0, rt<3600)$rt)/1000, 2)`s (SD = `r round(sd(dplyr::filter(splt, rt > 0, rt<3600)$rt)/1000, 2)`s).
Most participants completed all trials with only occasional missed responses (Table \ref{tab:trialstats})).
For a small number of participants, far fewer trials were obtained (min = `r min(dplyr::summarize(dplyr::group_by(dplyr::filter(splt, !is.na(pressed_r)), id), n = n())$n)`, with n = `r sum(dplyr::summarize(dplyr::group_by(dplyr::filter(splt, !is.na(pressed_r)), id), n = n())$n < 350)` having fewer than 350 trials) either as a result of early termination, or because of computer error during data file saving.



\begin{table}
\centering
\begin{threeparttable}
\caption{Probability that an optimal choice results in reward} \label{tab:optpressstats}
\small
```{r optpressstats, results='asis'}
ptab(optimal_press_prop_table)
```
\begin{tablenotes}
\footnotesize
\item `r sample_abbreviation_note` PDS: Pubertal development scale. 
\end{tablenotes}
\end{threeparttable}
\end{table}

\begin{table}
\centering
\begin{threeparttable}
\caption{Number of trials completed} \label{tab:trialstats}
\small
```{r trialstats, results='asis'}
ptab(trials_table)
```
\begin{tablenotes}
\footnotesize
\item `r sample_abbreviation_note`
\end{tablenotes}
\end{threeparttable}
\end{table}

```{r reactiontime, fig.width=4, fig.height=3, cache=F, fig.cap='\\label{fig:reactiontime}Distribution of reaction times for all participants. The vertical line set a 1s, which is close to the mean reaction time across all samples.'}
print(reaction_time_plot)
```

