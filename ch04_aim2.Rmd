---
documentclass: apa6
classoption: "margin=1in,man,floatsintext"
header-includes:
  # - \usepackage[para,online,flushleft]{threeparttable}
  - \usepackage{wrapfig}
  - \usepackage[singlelinecheck=false]{caption}
  - \captionsetup[subfigure]{singlelinecheck=on, labelfont=normalfont}
  - \captionsetup[figure]{labelfont=it}
  - \shorttitle{SOCIAL MOTIVES \& REINFORCEMENT LEARNING}
title: "Measurement of social motives: relations between self report and reinforcement learning"
author: "John C. Flournoy"
output: 
  pdf_document:
    keep_tex: yes
    template: "default-1.17.0.2_nogeom.tex"
bibliography: "/home/jflournoy/code_new/social-motives-rl-writeup/dissertation.bib"
csl: "/home/jflournoy/Rlibs/probly/bib/apa-old-doi-prefix.csl"
---

```{r setupch4, include=FALSE}
knitr::opts_chunk$set(fig.path = 'figures/', echo = F, warning = F, error = F, message = F)
library(probly)
load('rda/fsmi-cfa.rda')
ggplot2::theme_set(ggplot2::theme_minimal())

sample_abbreviation_note <- 'FCA: foster-care-involved adolescents; CA: community adolescents; CSYA: college students; CSYA-O: college students, online.'
```

# Background

- Review Neel, fsmi lit
  - Evidence for validity
  - Relation to outcomes
    - note expected long-term-relationship differences
- Review Foulkes, SRQ lit
  - Evidence for validity
  - Relation to outcomes
    - note there are not expected long-term-relationship differences
- Review sensation seeking
  - Validity
  - Relation to outcomes
- Describe outcomes of interest
  - FSMI Mate-seeking (FSMI-MS) and K-SRQ sexual relationship (K-SRQ-SR)
    - Normative sexual behavior
      - Number of partners
      - Number of sexual encounters
  - FSMI-MS, K-SRQ-SR, FSMI status, K-SRQ admiration, Sensation seeking
      - Safe sex practice
      - Substance use and sex
      - Alcohol use
  
# Method

The primary goals of these analyses are to establish that the scales as measures of the constructs of interest, examine whether they provide any convergent evidence that individual differences in the Social Probabilistic Learning Task (SPLT) are related to motives, explore their association with adolescent health-related behavior, and, finally, to explore the assocations between this behavior and learning during the SPLT.
Most interpretive decisions will be made on the basis of effect size, without thresholding based on test statistics.
The primary excpetion to this is during the pyschometric testing phase, as described below.
All analyses, unless specified otherwise, were performed using the lavaan package [version `r packageVersion('lavaan')`; @rosseel2012] in R.

## Scale validation

Quality of measurement is a crucial precursor to drawing inferences from statistical tests, and so guidelines for testing measurement invariance are followed for each scale below [@gregorich2006].
Invariance between groups based on self-reported gender, sample (when possible), and long-term relationship status (in the college samples) is tested for each self-report scale that is based on a reflective latent variable model (which does not include self-report sexual or substance use behaviors).
Although comparisons between reported gender groups, or samples, are not the focus of this investigation, both groupings appear in models in order to examine the sensitivity of results to group characteristics.

For testing metric invariance, which is required to make inferences based on latent covariance structures, we use the McDonalad Non-centrality Fit Index (MFI) because this has been shown to be robust to differences in sample size and magnitude of item loadings [@kang2016].
In simulations performed by @kang2016, $\Delta\text{MFI} > .01$ was seen in less than 1\% of invariance tests when the null of measurement invariance between groups is true, though the authors caution against rules-of-thumb like this more generally.
In other simulations [@johnflournoy2018], $\Delta\text{MFI} > .012$ was roughly the cutt-off for the 1\% level.
The tests below follow these guidelines roughly: when fit differences in the MFI between invariant, or paritially-invariant, scales is more than .012, constraints on particular items (suggested by modification indices) are relaxed until the fit difference is no longer substantially concerning.
However, because these items not longer contribute to the model in the same way, and because content coverage of the scales is another important concern for validity [@borsboom2006], the final partially invariant scale is not embraced credulously.
When substantial modification is necessary, sensitivity analyses is performed to compare estimates between the fully constrained scales and the partially constrained (i.e., partially invariant) measurement models.
If results are not too different, then we can be assured that in this case, neither measurement nor content differences are strongly influential on the range of inferences we might make.
If results do appear markedly different, then it is difficult to adjudicate which is the more interpretable.

The final model chosen for more extensive interpretation is selected on the basis of parsimonious model fit.
Smaller values of the Akaike Information Criterion (AIC), an estimate of out-of-sample predictive accuracy that incorporates model parsimony [@akaike1998;@gelman2014], will be used to determine whether emphasis should be given to models that constrain substantive estimates across groups (e.g., samples).
When appropriate, even if the AIC indicates the constrain may provide better predicitive accuracy, we can examine differences in estimates between different groups to ensure that this is a reasonable conclusion.

In order to characterize the cross-sectional age associations for each scale, the measurement models will be used to regress each latent variable on a quadratic function of age, with the gender factor interating with age.
These structural models are intended to provide information on how well these associations converge with expectations based on the social reorientation theory (in the case of status and mate-seeking related constructs), as well as expectations based on past research on impulsivity and sensation seeking during adolescence as described above.
Specifically, the hope, with regard to validating the construct validity of these scales, is to see higher levels of interest in status-related, and mate-seeking-related constructs in older and more pubertally advanced participants (at least up until physical maturity), and higher levels of both sensation seeking and impulse control (or rather, lower levels of urgency) in older participants.
An important caveat to the examination of this descriptive evidence regarding construct validity or more substantive claims is that in cross-sectional data, both convergence and divergence with expecatations may be due to factors other than age.

To further examine the case for the valdity of these scales as measurements of the constructs they purport to measure, we can examine the relations between them.
In order to do so, all latent variable measurement models will be combined to examine inter-scale correlations, with attention to convergence between ostensibly related constructs. 
The college sample was administered all questionnaires, allowing the full inter-scale correlation matrix to be estimated in this sample only.
Correlations among latent variables will also be examined across all samples for the K-SRQ and UPPS-P.
Speciall attention will be given to the FSMI Mate-seeking and Status scales, the K-SRQ Sexual Relationships and Admiration scales, and the UPPS-P Sensation Seeking scale. 


## Self report relation to SPLT

- Using raw $P_{O}$ calculated from behavior
- Using model-estimated learning parameters

## Self report relation to outcomes

First, the motive-related scales may be further evaluated for construct validity on the basis of their relation to self-reported behaviors which would be expected to result from those motives.
For example, in general, those who are in long-term relationships should report lower levels of interest in seeking out new romantic or sexual parterns (i.e., lower scores on the FSMI Mate-Seeking scale).
Among all participants (but perhaps especially those in long-term relationships), higher levels on the K-SRQ Sexual Relationships scale should be related to higher numbers of sexual encounters (specifically, "how many times, in the last six months, have you had sex/sexual relations," with sexual relations defines as "oral, vaginal or anal, and can be with male or female partners").
Among those who are not in long-term relationships, higher FSMI Mate-Seeking and K-SRQ Sexual Relationships (which is supposed to measure the enjoyment of sexual behavior) should be related to having had more, recent, sexual partners (specifically, "with how many different people in the last 6 months").
Finally, though it is more speculative, because of the item content related to parties and social events, higher scores on the K-SRQ Sociability may be expected to relate to greater number of days having had at least one drink ("In the past 30 days, on how many days did you have at least one drink of alcohol"), at least in the college sample.

The more substantively interesting questions involve the relation between risky sexual behavior and alcohol use.
The outcomes of interest are:
  - "In the last 6 months, what percentage of the time when you've had sexual relations (oral, vaginal or anal) did you USE safe sex practices to prevent sexually transmitted diseases - condoms, blood tests, dental dams, etc.)"
  - "Did you drink alcohol or use drugs before you had sexual intercourse the last time you had sex?"
  - "In the past 30 days, on how many days did you have 5 or more drinks of alcohol in a row, that is, within a couple hours?"

The data generating processes for the behavioral outcomes are not gausian, nor do they necessarily result in data where a unit difference has the same meaning.
To account for this, certain analysis and data transformation decisions were made.
For frequency of sex, number of partners, number of past 30 days with alcohol, and number of past 30 days with five or more alcoholic drinks, responses were analyzed as ordinal outcomes.
This required binning responses for some variables.
Participants were free to input any number for the frequency of sex question, so to ensure that ordered categories contained at least 30 participants, responses were binned into groups with 0, 1-9, 10-19, 20-39, and 40 or more sexual encounters in the past six months.
Responses to the number of partners in the last six months was also binned into groups with 0, 1, 2, and 3 or more, with at least 40 participants in each bin.
The response options for both alcohol use questions were constrained, with response options, in days, set to 0, 1-2, 3-5, 6-9, 10-19, 20-29, and "All 30".
For both responses, very few or no participants selected 20 or more days, and only 6 participants selected 10-19 days for the question asking about having had five or more drinks in one session.
Bins on the high end were combined resulting in five bins for the question asking about days having any number of drinks (0, 1-2, 3-5, 6-9, 10 or more), and in four bins for the question about days having five or more drinks (0, 1-2, 3-5, 6 or more).
The question regarding safe sex practice was analyzed continuously because the response options asked about continuous frequency, and the question about substance use prior to sex was analyzed as a binary categorical outcome.
Analysis of categorical outcomes used ordinal regression using a diagonally weighted least squares estimator with robust standard errors and a mean and variance adjusted test statistic (corresponding to the WLSMV estimator in the lavaan package).

Gender and (if the adolescent participants could be included) age were added as covariates to all models.
Associations between target motive variables and outcomes were estimated both with and without UPPS-P Sensation Seeking and both Urgency variables as covariates to explore sensitivity of the outcomes to variance shared between these measurements.
Also, in the case of K-SRQ variables, sensitivity to the inclusion of highly correlated subscales was also tested.
For example, if the Sexual Relationships variable was included as the focal independent variable, the Admiration and Sociability variables were added as covariates.

Interpretation of associations (both with self-report scales, and when considering the SPLT variables) with self report behavior is based on the sign of the focal motive variable coefficient, and on the $\chi^2$ difference test ($\alpha < .005$) between a model including the focal motive variable and covariates, and the same model with the motive variable coefficient fixed to 0.
To examine sensitivity to inclusion of the UPPS-P scales, comparison was between the model with all variables (motive, UPPS-P Sensation Seeking, and Positive and Negative Urgency), and the same model with the motive coefficient fixed to 0.
That is, the test examined fit decrease due to excluding the relation between the outcome and motive variable.
Sensitivity to the addition of K-SRQ subscales tested models with the zero-coefficient constraint set on the added variable, with examination of size and sign change of the focal motive variable coefficient.

Finally, the subset of these analyses examining associations with number of sexual partners are estimated using only the participants who report not being in a long-term relationship.
For completeness, the same analysis is repeated without regard for long-term relationship status and note is made of any substantial differences.

## SPLT relation to outcomes

The same behavioral outcomes are also regressed on the relevant contrasts of all SPLT variables.
Specifically, self report sexual behavior is regressed on the Dating/Looking - Hungry/Thirsty contrast for each parameter, $\epsilon, \rho, \xi, b$, and the same contrast for the proportion of optimal decisions made during both the first and last half of the run.
Self-report drinking is regressed on the Popular/Unpopular - Hungry/Thirsty contrasts of these variables.

# Results

## Evaluating scales

### Fundamental Social Motives Inventory

The Fundamental Social Motives Inventory (FSMI) was administered to the college sample only (both because the questions are not appropriate for younger adolescents, and because time did not allow for this additional inventory).
For the specific purposes of this study, the analyses below focus on the Mate-seeking and Status factors, though an examination of the full inventory is doubtless of interest, more generally.
Invariance of loadings of items on factors (metric invariance) between participants reporting male versus female gender on the pubertal development scale (PDS) was tested and found acceptable, with a slight increase in fit after constraining factor loadings ($\Delta\text{MFI}= `r round(fsmi_matestat_cfa_fit[['delta1']][['mfi']],3)`$).
The final confirmatory factor analysis (CFA) for mate-seeking and status factors fit well ($\text{N}_{\text{total}}$ = `r lavaan::inspect(fsmi_cfa_matestat_gender_metric, what = 'ntotal')`, RMSEA = `r round(fsmi_matestat_cfa_fit[['fsmi_cfa_matestat_gender_metric']][['rmsea']],3)`, $\text{MFI}$ = `r sprintf('%0.2f', fsmi_matestat_cfa_fit[['fsmi_cfa_matestat_gender_metric']][['mfi']])`, $\hat\gamma$ = `r round(fsmi_matestat_cfa_fit[['fsmi_cfa_matestat_gender_metric']][['gammaHat']],2)`).
Adding equality constraints on the latent covariance structure resulted in better parsimony-adjusted model fit as measured by the differences in the Akaike information criterion (AIC; $\Delta\text{AIC}= `r round(fsmi_matestat_cfa_fit[['delta2']][['AIC']],0)`$), with the two factors showing a very small, positive, non-significant correlation ($r = `r round(fsmi_mate_stat_cor[['std.all']][[1]],2)`, Z = `r round(fsmi_mate_stat_cor[['z']][[1]],2)`$).
Note that item 54, "I do not worry very much about losing status," has a particularly low loading on the status factor ($\beta$ = `r round(fsmi_mate_stat_par[fsmi_mate_stat_par$op == '=~' & fsmi_mate_stat_par$rhs == 'fsmi_qs_54','std.all'][[1]],2)`).
Associations with age and pubertal development were not examined given the narrow range of each of these measurements in this sample.

### Dominance and Prestige

The Dominance and Prestige scale (D&P) was also administered to the college sample only (because time did not allow for it).
Invariance of loadings between males and females was tested and found to decrease fit ($\Delta\text{MFI} = `r round(dnp_cfa_fit[['delta1']][['mfi']],3)`$).
Modification indices indicated that freeing the constraint of equality between groups for the item, "Some people are afraid of me", would improve fit, and doing so resulted in an acceptable decrease in fit between the (partially) metric invariant and unconstrained models ($\Delta\text{MFI} = `r round(dnp_cfa_fit[['delta2']][['mfi']],3)`$).
Further improvements were not sought as relaxing constraints on this single item both broadly protects the scale's content coverage [@borsboom2006], while providing fairly acceptable fit differences. 
This partial-metric invariance model is the model used in all analyses below, and sensitivity of results to the relaxation of this constraint is not tested.
The final, partially metric invariant CFA for Dominance and Prestige factors fit somewhat poorly ($\text{N}_{\text{total}}$ = `r lavaan::inspect(dnp_cfa_gender_partmetric, what = 'ntotal')`, RMSEA = `r round(dnp_cfa_fit[['dnp_cfa_gender_partmetric']][['rmsea']],3)`, $\text{MFI}$ = `r round(dnp_cfa_fit[['dnp_cfa_gender_partmetric']][['mfi']],2)`, $\hat\gamma$ = `r round(dnp_cfa_fit[['dnp_cfa_gender_partmetric']][['gammaHat']],3)`).
Further constraining the latent covariance and variance to be equal between both females and males resulted in slightly better model fit ($\Delta\text{AIC} = `r round(dnp_cfa_fit[['delta3']][['AIC']],0)`$), with the two factors showing a small, positive, correlation ($r = `r round(dnp_mate_stat_cor[['std.all']][[1]],2)`, Z = `r round(dnp_mate_stat_cor[['z']][[1]],2)`$).
Associations with age and pubertal development were not examined given the narrow range of each of these measurements in this sample.

### Kids' Social Reward Questionnaire

The Kids' Social Reward Questionnaire (K-SRQ), and remaining self-report instruments, were administered to each college and adolescent samples.
The Negative Social Potency and Prosocial Iteractions factor indicators were almost all very highly skewed, so these subscales were dropped before any further analysis was performed.
The four factors included below are: Admiration, Passivity, Sexual Relationships, and Sociability.

A CFA for the four K-SRQ factors was tested for metric invariance across samples by comparing a model with loadings constrained to equality to one with loadings free to vary across the four groups.
This resulted in considerably worse model fit ($\Delta\text{MFI} = `r round(ksrq_cfa_fit[['delta1a']][['mfi']],3)`$).
Loading constraints were removed from four items ("I like it if others looks up to me", "I like being a member of a group/club", "I like kissing", "I like flirting") that load onto Admiration, Sociability, and  Sexual Relationships, respectively.
This resulted in adequately small fit differences between the unconstrained and partial-metric invariance models (`r ksrq_cfa_metric_invar_stats`).
The final model showed somewhat poor fit ($\text{N}_{\text{total}}$ = `r lavaan::inspect(ksrq_cfa, what = 'ntotal')`, RMSEA = `r round(ksrq_cfa_fit$ksrq_cfa_metric[['rmsea']],2)`, MFI = `r round(ksrq_cfa_fit$ksrq_cfa_metric[['mfi']],2)`, $\hat\gamma$ = `r round(ksrq_cfa_fit$ksrq_cfa_metric[['gammaHat']],3)`). 

Metric invariance was also evaluated between reported gender groups.
The partial-metric invariance model from above was compared to the model without loadings constrained.
The fit decrease between these two models was not too big ($\Delta\text{MFI} = `r round(ksrq_cfa_fit[['delta_gender']][['mfi']],3)`$).

Next, models with and without between-sample equality constraints on latent variances and covariances were compared, resulting in better fit ($\Delta\text{AIC} = `r round(ksrq_cfa_fit$delta2[['AIC']])`$) for the constrained model.
Loadings without constraints across groups (in the partial-metric invariance model) do not contribute to this comparison, so the magnitude of correlations was compared across the partial-metric invariant and fully constrained models (both with the constraint of covariance across groups).
The differences in correlations were in the range _r_ = [`r round(min(ksrq_cor_diff),2)`, `r round(max(ksrq_cor_diff),2)`], indicating very low sensitivity the constraints on item loadings.
To maintain content coverage, the fully constrained model, with equality of loadings across all samples, is used, though sensitivity to constraints on the four non-invariant loadings is assessed again in subsequent analyses.

Correlations among the Admiration, Sociability, and  Sexual Relationships subscales were all high ($`r sprintf('r = [%.2f, %.2f]', min(lavaan::inspect(ksrq_cfa_metric_cov, 'cor.lv')$yads_online[-2, -2]), max(lavaan::inspect(ksrq_cfa_metric_cov, 'cor.lv')$yads_online[-2, -2] - diag(3)))`$). 
Correlations of Passivity with these three subscales were generally small, but positive ($`r sprintf('r = [%.2f, %.2f]', min((lavaan::inspect(ksrq_cfa_metric_cov, 'cor.lv')$yads_online)[2,]), max((lavaan::inspect(ksrq_cfa_metric_cov, 'cor.lv')$yads_online - diag(4))[2,]))`$; see Table ??? for all latent variable correlations).
This pattern of correlation is similar to what was seen in the scale construction sample [@foulkes2014].

#### Age

Variation in latent factors was described by a quadratic age regression, with age effects allowed to vary by gender.
The partial metric invariance model was used to test whether constraining regression coefficients across samples resulted in a better fitting model as assessed by the AIC.
Constraining the regression coefficients across sample resulted in reduced AIC ($\Delta\text{AIC} = `r round(diff(ksrq_cfa_metric_agesem_fit[,'AIC']),0)`$), indicated better model fit.
Standardized coefficients were extremely similar between the model with partial metric invariance and the model with all loadings constrained to equality across samples ($\Delta\beta = `r sprintf('[%0.2f, %0.2f]', min(ksrq_agesem_betadiffs), max(ksrq_agesem_betadiffs))`$), so the fully constrained model is interpretted.
Model-expected trend lines show somewhat higher scores in late adolescent participants (Figure \ref{fig:ksrqagepredplot}), with the largest quadratic effects (averaged across gender) for Admiration, Sociability, and Sexual Relationships (Table \ref{tab:ksrqage}).
Gender differences in the linear model coeficients were fairly small.

```{r ksrqagepredplot, fig.width=5.875, fig.height=3, include=F}
ksrq_age_pred_plot
```

\begin{figure}
\centering
\captionsetup{width=5.875in}
\includegraphics{figures/ksrqagepredplot-1.pdf}
\caption[K-SRQ model-predicted PDS associations]{K-SRQ model-predicted PDS associations. Best fit lines are expected latent variable values drawn from the model with all loadings, latent variances and covariances, and regression coefficients constrained to be the same across samples. Best fit lines are plotted separately for each sample, but because regression coefficients are identical, and the expected trajectories are otherwise very similar, they are not separately labeled. Points are individual, model predicted, latent variable values.}
\label{fig:ksrqagepredplot}
\end{figure}

\begin{table}
\centering
\begin{threeparttable}
\caption{K-SRQ factors regressed on age and gender} \label{tab:ksrqage}
\footnotesize
```{r ksrqage, results='asis'}
knitr::kable(dplyr::mutate(ksrq_std_par_table, 
                           lhs = sub('Sexual Relationships', 'Sexual rel.', lhs)),
             col.names = c('K-SRQ factor', 'Sample', 
                           '$\\text{Age}$', '$\\text{Age}\\times\\text{Gender}$', 
                           '$\\text{Age}^2$', '$\\text{Age}^2\\times\\text{Gender}$'),
             booktabs = TRUE, format = 'latex', escape = F,
             linesep = '')
```
\begin{tablenotes}
\footnotesize
\item `r sample_abbreviation_note`
\item Values are standardized regression coefficients from the model with all loadings, latent variances and covariances, and regression coefficients constrained to be the same across samples, with 95\% confidence intervals in brackets.
\end{tablenotes}
\end{threeparttable}
\end{table}

#### Puberty

We also described variation in latent factors by a quadratic PDS regression, with effects allowed to vary by gender.
The partial metric invariance model with constrained regression coefficients across samples resulted in a better fit ($\Delta\text{AIC} = `r round(diff(ksrq_cfa_metric_pdssem_fit[,'AIC']),0)`$).
Again, standardized coefficients were extremely similar between the model with partial metric invariance and the model with all loadings constrained to equality across samples ($\Delta\beta = `r sprintf('[%0.2f, %0.2f]', min(ksrq_pdssem_betadiffs), max(ksrq_pdssem_betadiffs))`$), so the fully constrained model is interpretted.
Model-expected trend lines show somewhat lower scores associated with lower PDS, primarily for female participants (Figure \ref{fig:ksrqpdspredplot}), with the largest linear effects (averaged across gender) for Socioability, and Sexual Relationships (Table \ref{tab:ksrqpds}).
Though a model including the quadratic effect of PDS was estimated, this was done to allow deceleration in the linear trend to approximate the observed asymptotic relation.

```{r ksrqpdspredplot, fig.width=5.875, fig.height=3, include=F}
ksrq_pds_pred_plot
```

\begin{figure}
\centering
\captionsetup{width=5.875in}
\includegraphics{figures/ksrqpdspredplot-1.pdf}
\caption[K-SRQ model-predicted PDS associations]{K-SRQ model-predicted age associations. Best fit lines are expected latent variable values drawn from the model with all loadings, latent variances and covariances, and regression coefficients constrained to be the same across samples. Best fit lines are plotted separately for each sample, but because regression coefficients are identical, and the expected trajectories are otherwise very similar, they are not separately labeled. Points are individual, model predicted, latent variable values.}
\label{fig:ksrqpdspredplot}
\end{figure}

\begin{table}
\centering
\begin{threeparttable}
\caption{K-SRQ factors regressed on age and gender} \label{tab:ksrqpds}
\footnotesize
```{r ksrqpds, results='asis'}
knitr::kable(dplyr::mutate(ksrq_std_pds_par_table, 
                           lhs = sub('Sexual Relationships', 'Sexual rel.', lhs)),
             col.names = c('K-SRQ factor', 'Sample', 
                           '$\\text{PDS}$', '$\\text{PDS}\\times\\text{Gender}$', 
                           '$\\text{PDS}^2$', '$\\text{PDS}^2\\times\\text{Gender}$'),
             booktabs = TRUE,
             escape = F, format = 'latex',
             linesep = '')
```
\begin{tablenotes}
\footnotesize
\item `r sample_abbreviation_note`
\item Values are standardized regression coefficients from the model with all loadings, latent variances and covariances, and regression coefficients constrained to be the same across samples, with 95\% confidence intervals in brackets.
\end{tablenotes}
\end{threeparttable}
\end{table}
  
### Urgency, Premedidation, Perseverence, Sensation Seeking and Positive Urgency

The Urgency, Premedidation, Perseverence, Sensation Seeking and Positive Urgency (UPPS-P) scale was also administered to all four samples.
This instrument uses a large number of indicators for each latent factor.
When doing an analysis with a separate group for each sample, this results in a number of variables that greater than the number of observations.
For this reason, measurement is assessed between combined adolescent and combined college-student samples.

A CFA for the five UPPS-P factors was tested for metric invariance across age groups by comparing a model with loadings constrained to equality to one with loadings free to vary across the four groups.
This resulted in adequately small fit differences between the unconstrained and invariant models (`r uppsp_cfa_metric_invar_stats`).
Metric invariance was also evaluated between reported gender groups, with practically no fit decrease ($`r sprintf('\\Delta\\text{MFI} = %0.4f', round(uppsp_cfa_fit[['delta_gender']][['mfi']],4))`$).

The fit statistics show mixed results, with acceptable RMSEA but also low MFI and $\hat\gamma$ ($\text{N}_{\text{total}}$ = `r lavaan::inspect(uppsp_cfa_metric, what = 'ntotal')`, RMSEA = `r round(uppsp_cfa_fit$uppsp_cfa_metric[['rmsea']],2)`, MFI = `r round(uppsp_cfa_fit$uppsp_cfa_metric[['mfi']],2)`, $\hat\gamma$ = `r round(uppsp_cfa_fit$uppsp_cfa_metric[['gammaHat']],3)`).
Other work has reported similarly ambiguous fit statistics for the UPPS-P in confirmatory factor analysis [@cyders2013].
This may be the reason for relatively similar degrees of fit between the unconstrained and metric invariance models.
We proceed with these analyses with the caveat that we cannot be confident latent variable covariance is not contaminated by differential item use.

Models with and without constraints on the equality of latent variances and covariances between age-groups were compared, resulting in lower AIC ($\Delta\text{AIC} = `r round(uppsp_cfa_fit$delta2[['AIC']])`$).
Absolute magnitude of correlations among all scales were between small and large (_r_ = `r sprintf('[%0.2f, %0.2f]', min(abs(uppsp_factor_cor)[abs(uppsp_factor_cor)>0]), max(abs(uppsp_factor_cor)))`), with very a very large correlation between Negative and Positive Urgency (_r_ = `r round(pos_neg_urg,2)`; see Table ??? for all latent variable correlations). 
Scales keyed in the positively valenced direction (Premeditation and Perseverance) were negatively correlated with negatively valenced scales (Negative and Positive Urgency, and Sensation Seeking).

#### Age

As with the K-SRQ, the association between UPPS-P factors and age was examined by regressing the latent variables on the interaction between a quadratic age model and gender.
Again, constraining the regression coefficients across sample results in reduced AIC ($\Delta\text{AIC} = `r round(diff(uppsp_cfa_metric_agesem_fit[,'AIC']),0)`$), indicating better model fit.
The model expectations reveal that the association between age and factor score may be conditional on reported gender.
Plots for Negative and Positive Urgency, Perseverance, and Sensation seeking show diverging quadratic trends for females and males (though note that expected correlation with age is fairly flat for both genders for Premeditation; Figure \ref{fig:uppspagepredplot}).
The standardized effects indicate that, averaged across gender, linear and quadratic associations were very small, but that for Perseverance, and Sensation seeking, the gender difference in the quadratic term is especially robust (Table \ref{tab:uppspage}).

```{r uppspagepredplot, fig.width=5.875, fig.height=3, include=F}
uppsp_age_pred_plot
```

\begin{figure}
\centering
\captionsetup{width=5.875in}
\includegraphics{figures/uppspagepredplot-1.pdf}
\caption[UPPS-P model-predicted age associations]{UPPS-P model-predicted age associations. Best fit lines are expected latent variable values drawn from the model with all loadings, latent variances and covariances, and regression coefficients constrained to be the same across samples. Best fit lines are plotted separately for each sample, but because regression coefficients are identical, and the expected trajectories are otherwise very similar, they are not separately labeled. Points are individual, model predicted, latent variable values.}
\label{fig:uppspagepredplot}
\end{figure}

\begin{table}
\centering
\begin{threeparttable}
\caption{UPPS-P factors regressed on age and gender} \label{tab:uppspage}
\footnotesize
```{r uppspage, results='asis'}
knitr::kable(uppsp_std_par_table,
             col.names = c('UPPS-P factor', 'Sample', 
                           '$\\text{Age}$', '$\\text{Age}\\times\\text{Gender}$', 
                           '$\\text{Age}^2$', '$\\text{Age}^2\\times\\text{Gender}$'),
             booktabs = TRUE, format = 'latex', escape = F,
             linesep = '')
```
\begin{tablenotes}
\footnotesize
\item Values are standardized regression coefficients from the model with all loadings, latent variances and covariances, and regression coefficients constrained to be the same across samples, with 95\% confidence intervals in brackets.
\end{tablenotes}
\end{threeparttable}
\end{table}

#### Puberty

The association between the UPPS-P latent factors and PDS was described using the same procedures as above.
Constraining the regression coefficients across sample results in better fit ($\Delta\text{AIC} = `r round(diff(uppsp_cfa_metric_pdssem_fit[,'AIC']),0)`$).
Model expected trend lines show very flat relations between PDS and latent factor scores with the exception of an accelerating qadratic fit and negative linear slope (tangent at PDS = 3) for Positive Urgency (Figure \ref{fig:uppsppdspredplot}).
Standardized regression coefficients echo the plots, all having small magnitude, with the exception of the larger negative slope for Positive Urgency (Table \ref{tab:uppsppds}).

```{r uppsppdspredplot, fig.width=5.875, fig.height=3, include=F}
uppsp_pds_pred_plot
```

\begin{figure}
\centering
\captionsetup{width=5.875in}
\includegraphics{figures/uppsppdspredplot-1.pdf}
\caption[UPPS-P model-predicted PDS associations]{UPPS-P model-predicted PDS associations. Best fit lines are expected latent variable values drawn from the model with all loadings, latent variances and covariances, and regression coefficients constrained to be the same across samples. Best fit lines are plotted separately for each sample, but because regression coefficients are identical, and the expected trajectories are otherwise very similar, they are not separately labeled. Points are individual, model predicted, latent variable values.}
\label{fig:uppsppdspredplot}
\end{figure}

\begin{table}
\centering
\begin{threeparttable}
\caption{K-SRQ factors regressed on age and gender} \label{tab:uppsppds}
\footnotesize
```{r uppsppds, results='asis'}
knitr::kable(uppsp_std_pds_par_table,
             col.names = c('UPPS-P factor', 'Sample', 
                           '$\\text{PDS}$', '$\\text{PDS}\\times\\text{Gender}$', 
                           '$\\text{PDS}^2$', '$\\text{PDS}^2\\times\\text{Gender}$'),
             booktabs = TRUE, format = 'latex', escape = F,
             linesep = '')
```
\begin{tablenotes}
\footnotesize
\item Values are standardized regression coefficients from the model with all loadings, latent variances and covariances, and regression coefficients constrained to be the same across samples, with 95\% confidence intervals in brackets.
\end{tablenotes}
\end{threeparttable}
\end{table}

### All scale correlations

All measurement models were combined in order to estimate correlations among the latent factors.
Though each of the measurement models show acceptable fit, this combine model shows very poor fit (college samples: `r sprintf('$N = %d, \\text{RMSEA} = %0.2f, \\text{MFI} = %0.0f$', lavaan::inspect(all_scales_college, 'ntotal'), lavaan::fitmeasures(all_scales_college, 'rmsea')[[1]], lavaan::fitmeasures(all_scales_college, 'mfi')[[1]])`; combined samples: `r sprintf('$N = %d, \\text{RMSEA} = %0.2f, \\text{MFI} = %0.0f$', lavaan::inspect(all_scales_adol, 'ntotal'), lavaan::fitmeasures(all_scales_adol, 'rmsea')[[1]], lavaan::fitmeasures(all_scales_adol, 'mfi')[[1]])`), indicating that this set of latent variables does not reproduce well the observed covariance among the indicators.
The possible reasons for this are discussed later, below, but not further explored analytically.
Combine models are descibed within the full college sample for all questionnaires, with a combined model with the K-SRQ and the UPPS-P across all four samples.

#### College samples

As was done above, the model constrained all loadings (except those freed above) and the latent covariance structure to be equal across gender groups, which fit better than allowing covariance to vary between genders ($\Delta\text{AIC} = `r round(diff(AIC(all_scales_college, all_scales_college_cor)[,2]))`$).
Further constraining the model to have equal loadings for all items resulted in only trivial differences in the latent variable correlation magnitudes (maximum absolute $\Delta r = `r round(college_cor_sensitivity_gender_abs_max, 2)`$).
This same pattern held when examining differences across partnered and unpartnered status ($\Delta\text{AIC} = `r round(diff(AIC(all_scales_college_partnered, all_scales_college_partnered_cor)[,2]))`$; maximum absolute $\Delta r = `r round(college_cor_sensitivity_partnered_abs_max, 2)`$).

The primary variables of interest are FMSI Mate-seeking, FSMI Status, K-SRQ Admiration, K-SRQ Sexual Relationships, and UPPS-P Sensation seeking.
These scales were, _a priori_, intended to measure mate-seeking and status motivation.
All latent variable correlations for the comprehensive measurement battery administered to the college samples can be found in Table \ref{tab:collegecor}.
The FSMI Mate-seeking variable shows correlations in the small-to-moderate range with most of the other variables, including both K-SQR Sexual Relationships and UPPS-P Sensation Seeking.
The FSMI Status variable showed more robust correlations with closely related variables.
Correlations with Dominance and Prestige status-strategies were large and very large, respectively, while the correlation with admiration was also very large.
Interestingly, the association between FSMI Status and K-SRQ Sexual Relationships was somewhat large.
The correlation between FSMI Status and K-SRQ Sociability is also large.
The strength of association between K-SRQ Admiration and Sexual Relationships is extremely large, as is the correlation between these variables and the K-SRQ Sociability scale.
Sensation Seeking shows medium correlations with the FMSI Status variable, both Dominance and Presige variables, as well as K-SRQ Sexual Relationships and Sociability scales, although the size of these correlations is of roughly the same magnitude as the correlations between Sensation Seeking and other UPPS-P variables.


\begin{table}
\centering
\begin{threeparttable}
\caption{Latent variable correlations, college sample} \label{tab:collegecor}
\footnotesize
\centering
```{r collegecor, results='asis'}
latent_var_labels <- c(
  ' 1. fsmi mate' = ' 1. Mate-Seeking\\textsuperscript{F}',
  ' 2. fsmi stat' = ' 2. Status\\textsuperscript{F}',
  ' 3. dominance score' = ' 3. Dominance\\textsuperscript{D}',
  ' 4. prestige score' = ' 4. Prestige\\textsuperscript{D}',
  ' 5. neg urgency' = ' 5. Negative Urgency\\textsuperscript{U}',
  ' 6. premeditation' = ' 6. Premeditation\\textsuperscript{U}',
  ' 7. perseverance' = ' 7. Perseverance\\textsuperscript{U}',
  ' 8. sensation seeking' = ' 8. Sensation Seeking\\textsuperscript{U}',
  ' 9. pos urgency' = ' 9. Positive Urgency\\textsuperscript{U}',
  '10. k srq admiration' = '10. Admiration\\textsuperscript{K}',
  '11. k srq passivity' = '11. Passivity\\textsuperscript{K}',
  '12. k srq sexual relationships' = '12. Sexual Relationships\\textsuperscript{K}',
  '13. k srq sociability' = '13. Sociability\\textsuperscript{K}')
latent_var_cor_table <- dplyr::mutate_at(latent_var_cor_table,
                                         dplyr::vars(2:14),
                                         dplyr::funs(ifelse(is.na(.), '', .)))
knitr::kable(
  dplyr::mutate(latent_var_cor_table[c(1:8)],
                rhs = latent_var_labels[rhs]),
  booktabs = TRUE, format = 'latex', escape = F,
  col.names = c('Latent variable', 1:7),
  linesep = '',
  align = c('l', rep('r', 7)))
```
\centering
```{r collegecor2, results='asis'}
knitr::kable(
  dplyr::mutate(latent_var_cor_table[c(1,9:14)],
                rhs = latent_var_labels[rhs]),
  booktabs = TRUE, format = 'latex', escape = F,
  col.names = c('Latent variable', 8:13),
  linesep = '',
  align = c('l', rep('r', 6)))
```
\begin{tablenotes}
\footnotesize
\item F = Fundamental Social Motives Inventory; D = Dominance \& Prestige scale; U = Urgency, Premeditation, Perseverance, Sensation-seeking, \& Positive Urgency scale; K = Kids' Social Reward Questionnaire.
\item Correlations between latent variables appear in the lower triangle; 95\% confidence intervals appear in the upper triangle. Source model constrains correlations and loadings for all items to be equal across gender groups.
\end{tablenotes}
\end{threeparttable}
\end{table}

#### College and adolescent samples

As was done above, the model constrained all loadings (except those freed above) and the latent covariance structure to be equal across subsamples, which fit better than allowing covariance to vary between them ($\Delta\text{AIC} = `r round(diff(AIC(all_scales_adol, all_scales_adol_cor)[,2]))`$).
Further constraining the model to have equal loadings for all items resulted in only trivial differences in the latent variable correlation magnitudes (maximum absolute $\Delta r = `r round(adol_cor_sensitivity_abs_max, 2)`$).

Of the variables measured in all four samples, those of primary interest are K-SRQ Admiration, K-SRQ Sexual Relationships, and UPPS-P Sensation seeking.
The first two scales were, _a priori_, intended to measure mate-seeking and status motivation, while the UPPS-P Sensation Seeking scale is intended as a reference point for other research on adolescence.
All correlations across the full sample can be found in Table \ref{tab:allcor}.
Across all samples, as with just the college sample, the correlations among the K-SRQ Admiration, Sexual Relationships, and Sociability scales are extremely large.
Sensation Seeking shows slightly stronger correlations with K-SRQ Admiration, Sexual Relationships and Sociability scales than in the college sample alone. 
However, as with the college sample, above, the size of these correlations are similar to, or smaller than, the UPPS-P scale inter-questionnaire correlations.

Even though model fit was improved by constraining correlations to be the same across samples, examining the pattern of estimated within-sample correlations may help increase our confidence that this is reasonable.
It is fairly clear in Figure \ref{fig:allscalesadolplot} that, with some variability, the same high level of correlation among three of the four K-SRQ variables is present in all samples, though that between Admiration and Sexual Relationships may be somewhat attenuated for the in-lab college students (CSYA) and the community adolescents (CA).
The relation between UPPS-P Sensation Seeking and K-SRQ Admiration, Sexual Relationships, and Sociability seems quite consistent.
The most striking differences are tangential to the scope of this manuscript, but may be worth pointing out: the correlation between KSR-Q Passivity and both Sexual Relationships and Admiration is large and negative within the foster-care-involved adolescent sample (FCA), whereas for the other samples it is usually closer to zero (with community adolescents [CA] showing a large positive correlation between Passivity and Sexual Relationships).

\begin{table}
\centering
\begin{threeparttable}
\caption{Latent variable correlations, all samples} \label{tab:allcor}
\footnotesize
\centering
```{r allcor, results='asis'}
latent_var_labels_all <- c(
  ' 1. neg urgency' = ' 1. Negative Urgency\\textsuperscript{U}',
  ' 2. premeditation' = ' 2. Premeditation\\textsuperscript{U}',
  ' 3. perseverance' = ' 3. Perseverance\\textsuperscript{U}',
  ' 4. sensation seeking' = ' 4. Sensation Seeking\\textsuperscript{U}',
  ' 5. pos urgency' = ' 5. Positive Urgency\\textsuperscript{U}',
  ' 6. k srq admiration' = ' 6. Admiration\\textsuperscript{K}',
  ' 7. k srq passivity' = ' 7. Passivity\\textsuperscript{K}',
  ' 8. k srq sexual relationships' = ' 8. Sexual Relationships\\textsuperscript{K}',
  ' 9. k srq sociability' = ' 9. Sociability\\textsuperscript{K}')
latent_var_cor_table_adol <- dplyr::mutate_at(latent_var_cor_table_adol,
                                              dplyr::vars(2:10),
                                              dplyr::funs(ifelse(is.na(.), '', .)))
knitr::kable(
  dplyr::mutate(latent_var_cor_table_adol[c(1:6)],
                rhs = latent_var_labels_all[rhs]),
  booktabs = TRUE, format = 'latex', escape = F,
  col.names = c('Latent variable', 1:5),
  linesep = '',
  align = c('l', rep('r', 5)))
```
\centering
```{r allcor2, results='asis'}
knitr::kable(
  dplyr::mutate(latent_var_cor_table_adol[c(1,7:10)],
                rhs = latent_var_labels_all[rhs]),
  booktabs = TRUE, format = 'latex', escape = F,
  col.names = c('Latent variable', 6:9),
  linesep = '',
  align = c('l', rep('r', 4)))
```
\begin{tablenotes}
\footnotesize
\item U = Urgency, Premeditation, Perseverance, Sensation-seeking, \& Positive Urgency scale; K = Kids' Social Reward Questionnaire.
\item Correlations between latent variables appear in the lower triangle; 95\% confidence intervals appear in the upper triangle. Source model constrains correlations and loadings for all items to be equal across gender groups.
\end{tablenotes}
\end{threeparttable}
\end{table}


```{r allscalesadolplot, fig.width=5.875, fig.height=7, include=F}
all_scales_adol_plot + 
  ggplot2::theme(strip.text.y = ggplot2::element_text(size = 7))
```

\begin{figure}
\centering
\captionsetup{width=5.875in}
\includegraphics{figures/allscalesadolplot-1.pdf}
\caption[Latent variable correlations by subsample]{Latent variable correlations by subsample. The correlation for all subsamples is taken from the model with all loadings and latent (co)variances constrained to be equal across subsamples. Subsample correlations are taken from the model with partial metric invariance. U = Urgency, Premeditation, Perseverance, Sensation-seeking, \& Positive Urgency scale; K = Kids' Social Reward Questionnaire; - = Negative; + = Positive. `r sample_abbreviation_note`}
\label{fig:allscalesadolplot}
\end{figure}

## Self report relation to SPLT

Four parameters from the reinforcement learning model of the SPLT behavior, and two summary statistics of optimal responding during the first and second half of the run, were correlated with all latent variables.
The variables for the SPLT have a value for every condition (Hungry/Thirsty, Popular/Unpopular, Dating/Looking), as well as for the contrasts between the two social conditions and the minimally social condition.
Including all SPLT variables in the combined measurement model caused problems with convergence that were not solved by changing the optimizer or adjusting optimization control options.
For this reason, latent variable correlations were estimated for each SPLT-variable parameter subset separately.



## Self report relation to outcomes

- FSMI-MS, K-SRQ-SR, FSMI status, K-SRQ admiration, Sensation seeking
  - For each compare to model with and without sensation seeking/impulsivity
    - Safe sex practice
      - "In the last 6 months, what percentage of the time when you've had sexual relations (oral, vaginal or anal) did you USE safe sex practices to prevent sexually transmitted diseases - condoms, blood tests, dental dams, etc.)"
    - Substance use and sex
      - "Did you drink alcohol or use drugs before you had sexual intercourse the last time you had sex?"
    - Alcohol use
      - "In the past 30 days, on how many days did you have at least one drink of alcohol?"
      - "In the past 30 days, on how many days did you have 5 or more drinks of alcohol in a row, that is, within a couple hours?"

### Relation to normative sexual behavior

This serves to ensure that the the Fundamental Social Motives Inventory, Mate-Seeking (FSMI-MS), and Kids' Social Reward Questionnaire (K-SRQ-SR) scales are measuring what they ought to be. 
We would expect positive relations between FSMI-MS and number of sexual partners in people who are not in a long term relationship (LTR-). 
For those in a long term relationship (LTR+), the reported number of sexual partners is strongly modally 1, and the average score on mate-seeking is very low.
This is the expected behavior of the scale, which is supposed to measure a persons present desire to meet new romantic or sexual partners [@neel2015].
The K-SRQ-SR measures a person's enjoyment of socio-sexual behavior, with items asking about kissing, flirting, and having crushes.
This is in fact a modified version of the original SRQ-SR which instead featured questions about the enjoyment more specifically of sexual activity [@foulkes2014]. 

_Note gender and age controls used where appropriate_

#### FSMI
- Number of partners
  - FSMI mate-seeking +related to num partners 
    - Within LTR- group only, $N = 157, \beta = .24$
    - _Also_ across all college participants, $N = 214, \beta = .24$
  - Women who are not in long term relationships report fewer partners than men ($\beta = -.51$)
  - No age control (too narrow a range)
- Number of encounters
  - Group analysis in partnered and unpartnered college students
  - Close to 0 FSMI mate-seeking relation with number of encounters 
    - $N = 203; \beta_{\text{LTR-}} = -.09; \beta_{\text{LTR+}} = -.03$
  - Gender related just for LTR- Women LTR- have fewer encounters than men
    - $\beta_{\text{LTR-}} = -.47; \beta_{\text{LTR+}} = .00$; gender-effect difference not tested
  - No age control (too narrow a range)

#### K-SRQ

- Number of partners
  - K-SRQ sexual relationships +related to num partners
    - Within LTR- college sample only, $N = 140, \beta = .35$
      - Controlling for gender, $\beta_{\text{F-M}} = -.19$
    - _Also_ across all participants that have data, $N = 260, \beta = .34$
      - Controlling for age and gender, $\beta_{\text{age}} = .42, \beta_{\text{F-M}} = -.03$
- Number of encounters
  - Group analysis in partnered and unpartnered college students (N = 203)
    - K-SRQ sexual relations scale association in LTR- group
      - $\beta_{\text{LTR-}} = .35; \beta_{\text{LTR+}} = .13$
    - Gender effect not significant but expected direction
      - Women LTR- have fewer encounters than men, $\beta_{\text{LTR-}} = -.14; \beta_{\text{LTR+}} = .08$; gender-effect difference not tested
    - No age control (too narrow a range)
  - Across all college and adolescent participants with data (N = 253)
    - K-SRQ sexual relations scale $\beta=.35$
    - Controlling for age and gender ($\beta_{\text{age}}=.49, \beta_{\text{F-M}} = .06$)

#### FSMI-MS & K-SRQ-SR

- Unpartnered college students (N = 132)
- Number of partners: $\beta_{\text{FSMI-MS}}=.18,\beta_{\text{K-SRQ-SR}}=.30,\beta_{\text{F-M}}=-.18$
- Number of encounters: $\beta_{\text{FSMI-MS}}=-.24,\beta_{\text{K-SRQ-SR}}=.39,\beta_{\text{F-M}}=-.15$


## SPLT relation to outcomes

This section may be largely perfunctory if in fact the task is not sensitive to individual differences in motives.

- Contrasted model parameters and mean optimal behavior as regressors for 
  - Safe sex practice
    - "In the last 6 months, what percentage of the time when you've had sexual relations (oral, vaginal or anal) did you USE safe sex practices to prevent sexually transmitted diseases - condoms, blood tests, dental dams, etc.)"
  - Substance use and sex
    - "Did you drink alcohol or use drugs before you had sexual intercourse the last time you had sex?"
  - Alcohol use
    - "In the past 30 days, on how many days did you have at least one drink of alcohol?"
    - "In the past 30 days, on how many days did you have 5 or more drinks of alcohol in a row, that is, within a couple hours?"


# Discussion, aim 2

- Scale validation
  - Inter-scale correlations
    - FSMI Mate-seeking is the only scale that asks questions about actively seeking out new romantic or sexual partners. Interestingly, in this sample of University of Oregon undergraduates, this does not seem to be related very strongly to the socio-sexual reward propensity as measured by the K-SRQ Sexual Relationships scale, and is only very weakly associated with more general reward sensitivty as measured by Sensation Seeking.
- Cross sectional
  - That the data are cross-sectional, and are sampled from different populations, should strongly qualify any strong inferences regarding age associations. 
  - For example, there is very robust, longitudinal evidence for a similar trend in males and females of increasing, decelerating development in sensation seeking over the age span considered here [@shulman2015].
  - The diverging quadratic fits for males and females may be largely a result of cohort differences caused by selection on university attendance
- SPLT task validation
  - Self report relation to SPLT
  - SPLT relation to outcomes
- Self report relation to outcomes
  - Especially as relevant to previous literature
  
------